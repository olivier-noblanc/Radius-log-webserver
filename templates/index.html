<!DOCTYPE html>
<html lang="en" data-theme="{{ theme }}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Enterprise RADIUS Log Management System - Real-time monitoring and analytics.">
    <meta name="author" content="Radius Log Team">
    <meta name="theme-color" content="#050505">
    <meta name="robots" content="noindex, nofollow">
    <title>RADIUS // LOG CORE</title>

    <!-- OpenGraph / Modern Meta -->
    <meta property="og:title" content="RADIUS // LOG CORE">
    <meta property="og:description" content="Advanced Log Analysis for RADIUS Servers">
    <meta property="og:type" content="website">

    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;500&family=Orbitron:wght@400;700&family=Rajdhani:wght@400;700&family=Fira+Code:wght@400;700&family=Press+Start+2P&family=VT323&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/bootstrap-icons.min.css">

    <!-- FAVICON -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">

    <!-- DYNAMIC CSS INJECTION (SSR + HTMX SWAP) -->
    <div id="theme-css" style="display: contents;">
        {% for css in css_files %}
        <link {% if css.contains("/themes/") %}id="theme-link" {% endif %} rel="stylesheet"
            href="{{ css }}?v={{ git_sha }}">
        {% endfor %}
    </div>

    <!-- HTMX 2.0.7 (Local) -->
    <script src="/js/htmx.min.js"></script>

    <!-- JS APP -->
    <script src="/js/app.js" defer></script>

    <!-- SVG PATTERNS -->
    <svg width="0" height="0" style="position: absolute;">
        <defs>
            <pattern id="nes-pixels" x="4" y="4" width="4" height="4" patternUnits="userSpaceOnUse">
                <rect x="0" y="0" width="2" height="2" fill="#ff0000" opacity="0.1" />
                <rect x="2" y="2" width="2" height="2" fill="#ff0000" opacity="0.1" />
            </pattern>
            <pattern id="snes-bevel" x="2" y="2" width="2" height="2" patternUnits="userSpaceOnUse">
                <rect x="0" y="0" width="1" height="1" fill="#ffffff" opacity="0.1" />
                <rect x="1" y="1" width="1" height="1" fill="#000000" opacity="0.2" />
            </pattern>
        </defs>
    </svg>
</head>

<body>

    <div id="app-root" class="app-root {% if is_authorized %}visible{% endif %}">
        <div class="crt-overlay"></div>
        <div class="scanlines"></div>

        {% include "partials/header.html" %}

        <div id="view-logs">
            <!-- Formulaire -->
            <form id="log-filters" hx-get="/api/logs/rows" hx-target="#logTableBody"
                hx-trigger="change from:select, change from:input[type=checkbox], input delay:500ms from:input[type=text]"
                class="flex items-center mb-4 glass-panel panel-main">

                <div class="flex-grow">
                    <select id="fileSelect" name="file" class="input-glass">
                        {% for file in files %}
                        <option value="{{ file.path }}" {% if file.path==current_file %}selected{% endif %}>{{
                            file.name }} ({{ file.formatted_size }})</option>
                        {% endfor %}
                        {% if files.is_empty() %}
                        <option>Aucun fichier</option>
                        {% endif %}
                    </select>
                </div>
                <div class="flex-grow">
                    <input type="text" id="searchInput" name="search" class="input-glass"
                        placeholder="Search (User, IP, Reason)..." value="{{ search_val }}">
                </div>
                <div class="flex items-center ml-4 gap-8 text-xs text-muted">
                    <input type="checkbox" id="errorToggle" name="error_only" value="true"
                        class="cursor-pointer w-18 h-18">
                    <label for="errorToggle" class="error-only-label">ERRORS ONLY</label>
                </div>

                <!-- Hidden inputs for sorting -->
                <input type="hidden" id="sort_by" name="sort_by" value="{{ sort_by }}">
                <input type="hidden" id="sort_desc" name="sort_desc" value="{{ sort_desc }}">

                <div>
                    <button type="submit" class="btn-glass btn-primary" id="loadBtn">REFRESH</button>
                    <a href="/api/export?file={{ current_file|urlencode }}&search={{ search_val|urlencode }}"
                        class="btn-glass" id="exportBtn">
                        EXPORT CSV
                    </a>
                </div>
            </form>

            <!-- Tableau -->
            <div class="glass-panel table-container">
                <table id="logTable">
                    <thead>
                        <tr>
                            <th class="sortable" hx-get="/api/logs/rows?sort_by=timestamp&sort_desc={% if sort_by == "
                                timestamp" %}{% if sort_desc %}false{% else %}true{% endif %}{% else %}true{% endif %}"
                                hx-include="#log-filters :not([name='sort_by']):not([name='sort_desc'])"
                                hx-target="#logTableBody">
                                TIMESTAMP <div class="resizer"></div>
                            </th>
                            <th class="sortable" hx-get="/api/logs/rows?sort_by=req_type&sort_desc={% if sort_by == "
                                req_type" %}{% if sort_desc %}false{% else %}true{% endif %}{% else %}true{% endif %}"
                                hx-include="#log-filters :not([name='sort_by']):not([name='sort_desc'])"
                                hx-target="#logTableBody">
                                TYPE <div class="resizer"></div>
                            </th>
                            <th class="sortable" hx-get="/api/logs/rows?sort_by=server&sort_desc={% if sort_by == "
                                server" %}{% if sort_desc %}false{% else %}true{% endif %}{% else %}true{% endif %}"
                                hx-include="#log-filters :not([name='sort_by']):not([name='sort_desc'])"
                                hx-target="#logTableBody">
                                SERVER <div class="resizer"></div>
                            </th>
                            <th class="sortable" hx-get="/api/logs/rows?sort_by=ap_ip&sort_desc={% if sort_by == "
                                ap_ip" %}{% if sort_desc %}false{% else %}true{% endif %}{% else %}true{% endif %}"
                                hx-include="#log-filters :not([name='sort_by']):not([name='sort_desc'])"
                                hx-target="#logTableBody">
                                AP IP <div class="resizer"></div>
                            </th>
                            <th class="sortable" hx-get="/api/logs/rows?sort_by=ap_name&sort_desc={% if sort_by == "
                                ap_name" %}{% if sort_desc %}false{% else %}true{% endif %}{% else %}true{% endif %}"
                                hx-include="#log-filters :not([name='sort_by']):not([name='sort_desc'])"
                                hx-target="#logTableBody">
                                AP NAME <div class="resizer"></div>
                            </th>
                            <th class="sortable" hx-get="/api/logs/rows?sort_by=mac&sort_desc={% if sort_by == " mac"
                                %}{% if sort_desc %}false{% else %}true{% endif %}{% else %}true{% endif %}"
                                hx-include="#log-filters :not([name='sort_by']):not([name='sort_desc'])"
                                hx-target="#logTableBody">
                                MAC <div class="resizer"></div>
                            </th>
                            <th class="sortable" hx-get="/api/logs/rows?sort_by=user&sort_desc={% if sort_by == " user"
                                %}{% if sort_desc %}false{% else %}true{% endif %}{% else %}true{% endif %}"
                                hx-include="#log-filters :not([name='sort_by']):not([name='sort_desc'])"
                                hx-target="#logTableBody">
                                USER <div class="resizer"></div>
                            </th>
                            <th class="sortable" hx-get="/api/logs/rows?sort_by=resp_type&sort_desc={% if sort_by == "
                                resp_type" %}{% if sort_desc %}false{% else %}true{% endif %}{% else %}true{% endif %}"
                                hx-include="#log-filters :not([name='sort_by']):not([name='sort_desc'])"
                                hx-target="#logTableBody">
                                RESULT <div class="resizer"></div>
                            </th>
                            <th class="sortable" hx-get="/api/logs/rows?sort_by=reason&sort_desc={% if sort_by == "
                                reason" %}{% if sort_desc %}false{% else %}true{% endif %}{% else %}true{% endif %}"
                                hx-include="#log-filters :not([name='sort_by']):not([name='sort_desc'])"
                                hx-target="#logTableBody">
                                DIAGNOSTICS <div class="resizer"></div>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="logTableBody">
                        {% include "log_rows.html" %}
                    </tbody>
                </table>
            </div>
        </div>

        <div id="view-dashboard" style="display: none;"></div>

        <!-- Security Modal -->
        <div id="securityModal" class="modal-overlay">
            <a href="#" class="close-overlay"></a>
            <div class="modal-content glass-panel p-6 max-w-md w-full animate-pop">
                <h2 class="text-xl font-bold mb-4">SECURITY LOCK</h2>
                <p class="mb-6 opacity-80">Access restricted. Verify identity to unlock control center.</p>
                <a href="/api/login" class="btn-lock w-full">VALIDATE IDENTITY</a>
            </div>
        </div>

        <!-- Detail Modal -->
        <div id="detailModal" class="modal-overlay">
            <a href="#" class="close-overlay"></a>
            <div
                class="modal-content glass-panel p-0 max-w-4xl w-full max-h-[90vh] flex flex-col overflow-hidden animate-pop">
                <div class="p-4 border-b border-white/10 flex justify-between items-center bg-black/20">
                    <h3 class="text-sm font-bold tracking-widest uppercase">LOG ENTRY DETAILS</h3>
                    <a href="#" class="btn-modal-close">&times;</a>
                </div>
                <div id="modalBody" class="p-6 overflow-y-auto custom-scrollbar"></div>
            </div>
        </div>

    </div>

    {% include "partials/footer.html" %}

</body>

</html>